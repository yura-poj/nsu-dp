# Репозиторий-темплейт для работы по курсу "Декларативное программирование"

## Что нужно сделать перед началом работы

### Программное обеспечение

Установите нужный софт:

- [Visual Studio Code](https://code.visualstudio.com/) - редактор, в котором мы будем работать;
- Пакет расширений `ms-vscode-remote.vscode-remote-extensionpack` для VS Code - позволит вести разработку в контейнерах Docker;
- [Docker Desktop](https://www.docker.com/products/docker-desktop/) - *движок* для контейнеров.
- [GitHub Desktop](https://desktop.github.com/) - довольно простой графический интерфейс для Git, который позволит не заморачиваться с командами; если у вас есть лицензия на GitKraken, вы предпочитаете работать в консоли или в интерфейсе VS Code - можно использовать их.

Если вы используете Windows:

- [Windows Subsystem for Linux](https://learn.microsoft.com/ru-ru/windows/wsl/install) - *ядро*, необходимое для запуска Linux-контейнеров на Windows.

### Аккаунты

Обзаведитесь аккаунтами на GitHub и Docker Hub: через первый вы будете сдавать домашние работы, а второй будет предоставлять доступ к базовым *изображениям* (кривой перевод **image**, не знаю, как перевести лучше) контейнеров.

## Готовим репозиторий и среду

### Создаём и настраиваем репозиторий

Если вы читаете это со страницы репозитория - сверху примерно посередине должна быть зелёная кнопочка **Use this template...**. Создайте копию текущей вкладки, чтобы не прыгать туда-сюда.

Нажмите на эту кнопку и создайте публичный репозиторий с названием `nsu-dp`. После этого, зайдите в настройки репозитория (пункт **Settings** со страницы репозитория) и выберите пункт **Collaborators**; нажмите на **Add people** и введите `kapkekes`: сделав это, вы сможете назначить меня проверяющим по пулл-реквестам, что позволит облегчить рабочий процесс.

### Вносим локальные изменения

После этого, вы можете клонировать репозиторий на ваш ПК. GitHub Desktop, GitKraken или же просто из консоли Git'ом - как вам удобнее.

Откройте репозиторий в VS Code и сделайте несколько важных действий.

Во-первых, убедитесь, что файл по пути `.devcontainer\library-scripts\common-debian.sh` от корня репозитория имеет `LF`-эндинги. Для этого откройте его через VS Code и посмотрите в нижний правый угол:

- если вы видите `LF` - всё в порядке, контейнер можно запускать;
- если вы видите `CRLF` - нажмите на надпись; сверху всплывёт выбор эндингов, выбирайте `LF`;

Во-вторых, укажите своё имя, почту и никнейм на GitHub в файле `.devcontainer\.stack\config.yaml`, чтобы Stack автоматически подставлял их при создании нового проекта.

После этого, нажмите на клавиатуре `Ctrl` + `P`, введите `> Dev Containers: Reopen in Container` и запускайте контейнер!

### 101: что делать, если в процессе сборки выползли ошибки?

Проверьте, что вы сохранили `LF`-эндинги в `.devcontainer\library-scripts\common-debian.sh`.

Откатите расширение **Dev Containers** (ID: `ms-vscode-remote.remote-containers`) до версии `v0.309.0`. Чтобы сделать это, найдите его в магазине расширений, нажмите на стрелочку справа от кнопки **Uninstall**, выберите **Install Another version...** и выберите `v0.309.0`.

## Как приступить к выполнению очередного ДЗ

### Создаём проект

Убедитесь, что ваша активная локальная ветка - это `main`, после чего создайте новую ветку с названием `homework-<номер-ДЗ>` (**важно: если номер ДЗ состоит из одной цифры - добавьте `0` перед ним!**) и переключитесь на неё.

Переходите в VS Code, если ещё нет, открывайте репозиторий в режиме контейнера.

После того, как контейнер проинициализировался, создайте проект для новой домашней работы:

```bash
stack new Homework<номер-ДЗ> kapkekes/<название-темплейта> --resolver lts-20.26
```

- номер ДЗ формируется так же, как и для имени ветки;
- название темплейта будет индивидуальным для каждого ДЗ (и, следовательно, будет выкладываться вместе с ней);
- опция `--resolver lts-20.26` *говорит* Stack'у использовать GHC версии **9.2.8** ([если интересно, почему такая странная связь](https://www.stackage.org/lts-20.26)) для данного проекта, а это как раз та версия, которая поставляется в контейнере.

После того, как Stack создал новый проект, перейдите в него, выполнив `cd Homework<номер-ДЗ>`. Для того, чтобы HLS корректно работал, необходимо выполнить две команды:

- `stack build` - создаст данные, с помощью которых HLS проведёт первичную индексацию кода;
- `gen-hie > hie.yaml` - создаст конфигурационный файл с указаниями для HLS, где искать сам код.

**Важно**: если в процессе работы вылезет уведомление по виду **Install HLS** - нажмите **Yes, don't ask next time**; после этого, VS Code начнёт управлять версией HLS самостоятельно.

### Проверяем тестами

После того, как вы завершите работу, вы сможете выполнить команду `stack test` (команда так же выполняется в папке проекта), которая соберёт актуальную версию решения и прогонит её на приложенных тестах.

Для проверки конкретного задания можно использовать аргумент `--test-arguments "--match <требуемая-функция>"`, который оставит только тесты, проходящие по переданному названию. Полная команда, таким образом, будет выглядеть как `stack test --test-arguments  "--match <требуемая-функция>"`.

### Открываем Pull Request

После того, как вы завершили работу - можно смело открывать PR. Делается это либо из интерфейса вашей среды, либо с пункта **Pull Requests** на странице вашего репозитория в GitHub. Не забудьте указать меня как ревьюера на странице пулл-реквеста: делается это через менюшку справа от тела пулл-реквеста.
